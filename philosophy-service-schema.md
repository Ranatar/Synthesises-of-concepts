# Схема взаимодействия философского сервиса с Claude API

## 1. Архитектура системы

### 1.1 Основные компоненты

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Frontend UI   │────▶│  Backend Server  │────▶│   Claude API    │
│  (Граф-редактор)│◀────│ (Обработка логики)│◀────│  (Генерация)    │
└─────────────────┘     └──────────────────┘     └─────────────────┘
         │                       │
         └───────┬───────────────┘
                 ▼
         ┌───────────────┐
         │  База данных  │
         │  (Категории,  │
         │   Связи,      │
         │   Концепции)  │
         └───────────────┘
```

### 1.2 Режимы работы

1. **Прямой режим**: Граф → Тезисы → Синтез
2. **Обратный режим**: Тезисы → Граф → Концепции
3. **Смешанный режим**: Частичные данные → Дополнение → Полная концепция
4. **Исследовательский режим**: Свободное экспериментирование

## 2. Составление графа концепции

### 2.1 Интерфейс пользователя

**Элементы управления:**
- Панель категорий (drag & drop)
- Панель типов связей
- Режим добавления весов (опционально)
- Поле названия концепции
- Кнопка "Предложить элементы" (AI-ассистент)

### 2.2 Процесс создания графа

#### Шаг 1: Инициализация
```javascript
// Пользователь может:
1. Начать с пустого графа
2. Загрузить существующую концепцию
3. Ввести тезисы для генерации графа
4. Ввести название для генерации структуры
```

#### Шаг 2: Добавление элементов

**Промпт для Claude при запросе предложений:**
```
Пользователь создает философскую концепцию с названием: {название}
Текущие категории: {список_категорий}
Текущие связи: {список_связей}

Предложи 3-5 дополнительных категорий и связей, которые бы органично дополнили эту концепцию. Для каждого предложения кратко объясни, почему оно релевантно.

Формат ответа:
{
  "categories": [
    {"name": "...", "rationale": "..."},
    ...
  ],
  "relations": [
    {"from": "...", "to": "...", "type": "...", "rationale": "..."},
    ...
  ]
}
```

#### Шаг 3: Валидация структуры

**Промпт для проверки целостности:**
```
Проанализируй граф философской концепции:
Категории: {категории}
Связи: {связи}

Проверь:
1. Логическую согласованность
2. Отсутствие противоречий
3. Полноту структуры

Если есть проблемы, предложи исправления.
```

### 2.3 Работа с весами (опционально)

```javascript
// Три режима весов:
1. "none" - без весов
2. "auto" - Claude определяет веса
3. "manual" - пользователь задает веса

// При auto режиме:
promptForWeights = `
Для графа концепции "${conceptName}" определи относительную важность элементов.
Используй шкалу 1-5, где:
1 - периферийный элемент
3 - стандартный элемент  
5 - центральный элемент

Учитывай только структурную роль в данной концепции, не абсолютную философскую значимость.
`
```

## 3. Генерация тезисов по графу

### 3.1 Базовая генерация

**Основной промпт:**
```
На основе следующего категориального графа философской концепции "${conceptName}" сформулируй основные тезисы.

Структура графа:
Категории: {categories}
Связи: {relations}
{weights ? `Веса элементов: ${weights}` : ''}

Требования к тезисам:
1. Отражай все ключевые связи между категориями
2. Формулируй ясно и конкретно
3. Избегай тавтологий и банальностей
4. Сохраняй философскую глубину
5. Количество тезисов: {targetCount || "оптимальное для раскрытия концепции"}

Формат вывода:
{
  "theses": [
    {
      "id": "T1",
      "text": "...",
      "categories": ["cat1", "cat2"], // связанные категории
      "strength": "high|medium|low" // сила тезиса
    },
    ...
  ],
  "meta": {
    "core_idea": "...", // центральная идея концепции
    "philosophical_tradition": "..." // философская традиция
  }
}
```

### 3.2 Итеративное уточнение

**Промпт для развития тезисов:**
```
Пользователь хочет развить тезис: "{thesis}"
Контекст концепции: {conceptContext}

Предложи:
1. Расширенную формулировку
2. Следствия из этого тезиса
3. Возможные контраргументы
4. Связи с другими тезисами концепции
```

### 3.3 Проверка консистентности

**Промпт для валидации:**
```
Проверь набор тезисов на внутреннюю согласованность:
{theses}

Выяви:
1. Противоречия
2. Логические пробелы
3. Избыточность
4. Упущенные связи из исходного графа

Предложи корректировки.
```

## 4. Обратная генерация: от тезисов к графу

### 4.1 Анализ тезисов

**Промпт для извлечения структуры:**
```
Проанализируй следующие философские тезисы:
{theses}

Задачи:
1. Выдели ключевые категории (понятия)
2. Определи типы связей между ними
3. Предположи возможную структуру концепции
4. Идентифицируй философскую традицию

Формат ответа:
{
  "extracted_categories": [...],
  "extracted_relations": [...],
  "suggested_concept_names": [...],
  "philosophical_context": "...",
  "confidence_level": "high|medium|low"
}
```

### 4.2 Реконструкция концепции

**Промпт для восстановления:**
```
На основе извлеченных категорий и связей восстанови целостную философскую концепцию.

Данные: {extractedData}

Дополни:
1. Недостающие связи
2. Имплицитные категории
3. Структурные элементы
4. Название концепции (если не задано)

Обоснуй каждое дополнение.
```

## 5. Синтез концепций

### 5.1 Подготовка к синтезу

**Интерфейс выбора:**
```javascript
// Пользователь выбирает:
1. Концепции для синтеза (2-5 штук)
2. Режим синтеза:
   - "dialectical" - диалектический (тезис-антитезис-синтез)
   - "integrative" - интегративный (объединение)
   - "creative" - творческий (новая концепция на основе)
3. Приоритетные элементы (опционально)
```

### 5.2 Процесс синтеза

**Основной промпт для синтеза:**
```
Создай синтез следующих философских концепций:

Концепция 1: {name1}
Граф: {graph1}
Тезисы: {theses1}

Концепция 2: {name2}
Граф: {graph2}
Тезисы: {theses2}

[... дополнительные концепции]

Режим синтеза: {mode}
Приоритетные элементы: {priorities || "определи автоматически"}

Требования:
1. Создай новую целостную концепцию, а не механическое объединение
2. Разреши противоречия между исходными концепциями
3. Сохрани наиболее продуктивные идеи каждой
4. Введи новые категории/связи при необходимости
5. Обоснуй структуру синтеза

Формат ответа:
{
  "synthesis": {
    "name": "...",
    "graph": {...},
    "theses": [...],
    "rationale": "...", // обоснование синтеза
    "innovations": [...], // новые элементы
    "resolutions": [...] // как разрешены противоречия
  }
}
```

### 5.3 Диалектический синтез (специальный режим)

**Промпт для диалектики:**
```
Выполни диалектический синтез:

ТЕЗИС: {concept1}
АНТИТЕЗИС: {concept2}

1. Выяви ключевые противоречия
2. Найди диалектическое единство противоположностей
3. Сформулируй синтез, снимающий противоречие на новом уровне
4. Покажи, как синтез сохраняет и превосходит оба исходных момента
```

## 6. Работа с базой данных

### 6.1 Обнаружение новых элементов

**Промпт для идентификации:**
```
В процессе генерации появились следующие элементы:
Категории: {newCategories}
Типы связей: {newRelationTypes}

Для каждого элемента определи:
1. Это действительно новый элемент или вариация существующего?
2. Каноническое название
3. Определение
4. Место в общей таксономии философских понятий
```

### 6.2 Обновление базы

**Процесс добавления:**
```javascript
// 1. Проверка уникальности
checkUniqueness(element) {
  // Fuzzy matching с существующими элементами
  // Проверка синонимов
}

// 2. Валидация
validateNewElement(element) {
  // Проверка определения
  // Проверка категоризации
}

// 3. Запрос подтверждения
requestUserConfirmation(element) {
  // Показать пользователю
  // Возможность редактирования
}

// 4. Добавление в базу
addToDatabase(element) {
  // Сохранение
  // Индексация для поиска
  // Обновление связей
}
```

## 7. Дополнительные сценарии

### 7.1 Поиск родительских концепций

**Промпт:**
```
Для данного набора тезисов/категорий определи возможные философские концепции-источники:

Данные: {data}

Найди:
1. Прямые источники (откуда взяты идеи)
2. Концептуальные предшественники
3. Философские школы/традиции
4. Конкретных философов

Оцени вероятность каждого соответствия.
```

### 7.2 Генерация вариаций

**Промпт:**
```
Создай вариации концепции "{name}" в разных философских традициях:

Исходная концепция: {concept}

Создай интерпретации в традициях:
1. Аналитическая философия
2. Континентальная философия
3. Восточная философия
4. [другие по запросу]

Сохрани ядро концепции, адаптируя форму выражения.
```

### 7.3 Критический анализ

**Промпт:**
```
Проведи критический анализ концепции:

Концепция: {concept}

Рассмотри:
1. Внутренние противоречия
2. Слабые места аргументации
3. Неучтенные аспекты
4. Альтернативные интерпретации
5. Возможные улучшения

Предложи пути развития концепции.
```

## 8. Обработка ошибок и edge cases

### 8.1 Неполные данные
- Автозаполнение недостающих элементов
- Запрос уточнений у пользователя
- Генерация нескольких вариантов

### 8.2 Противоречивые инструкции
- Выявление противоречий
- Запрос приоритетов
- Предложение альтернатив

### 8.3 Слишком сложные запросы
- Декомпозиция на подзадачи
- Поэтапное выполнение
- Промежуточные результаты

## 9. Оптимизация промптов

### 9.1 Контекстное окно
- Сжатие больших графов
- Приоритизация важных элементов
- Разбивка на части при необходимости

### 9.2 Кэширование
- Сохранение частых паттернов
- Переиспользование успешных генераций
- Обучение на обратной связи

## 10. Метрики и аналитика

### 10.1 Качество генерации
- Согласованность тезисов с графом
- Философская глубина
- Оригинальность синтеза

### 10.2 Пользовательские метрики
- Частота использования функций
- Типичные паттерны работы
- Точки затруднений

## 11. Примеры полных взаимодействий

### Пример 1: От названия к полной концепции

```
Пользователь: "Цифровой солипсизм"
→ Claude генерирует граф
→ Пользователь корректирует
→ Claude генерирует тезисы
→ Сохранение концепции
```

### Пример 2: Синтез противоположностей

```
Концепция 1: "Радикальный материализм"
Концепция 2: "Трансцендентальный идеализм"
→ Диалектический синтез
→ Новая концепция: "Эмерджентный дуализм"
```

### Пример 3: Исследование неизвестной концепции

```
Пользователь вводит тезисы неизвестного автора
→ Claude восстанавливает структуру
→ Определяет возможные источники
→ Предлагает развитие идей
```