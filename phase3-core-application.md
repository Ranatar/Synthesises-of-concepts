# Фаза 3: Разработка ядра приложения

## Описание фазы

Фаза 3 является ключевым этапом в разработке приложения, поскольку здесь создаются основные функциональные модули, составляющие ядро сервиса философских концепций. В рамках этой фазы будет реализован модуль управления концепциями, модуль работы с графами, модуль работы с тезисами и интеграция с бэкенд-прокси. По оценке, эта фаза потребует 30-40 сессий с Claude 3.7.

## Основные задачи

1. Реализация модуля управления концепциями
2. Реализация модуля работы с графами
3. Реализация модуля работы с тезисами
4. Интеграция с бэкенд-прокси

## Подробный план выполнения

### 1. Реализация модуля управления концепциями

#### 1.1. Разработка Redux-слайса для концепций

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать Redux-слайс для управления концепциями

КОНТЕКСТ:
- В Фазе 2 была создана базовая инфраструктура с настроенным Redux
- Необходимо разработать полный Redux-слайс для управления концепциями
- Слайс должен включать все необходимые actions, reducers и selectors
- Требуется интеграция с сервисом локального хранилища данных

ТРЕБОВАНИЯ:
1. Реализовать Redux-слайс с использованием Redux Toolkit
2. Определить структуру состояния для концепций
3. Реализовать actions для CRUD-операций с концепциями
4. Реализовать асинхронные thunks для работы с локальным хранилищем
5. Создать селекторы с мемоизацией для эффективного доступа к данным
6. Обеспечить обработку ошибок и состояний загрузки

ДЕТАЛИ:
Структура состояния должна включать:
- items: массив или объект с концепциями
- status: состояние загрузки ('idle', 'loading', 'succeeded', 'failed')
- error: сообщение об ошибке
- selectedConceptId: ID выбранной концепции
- filters: объект с фильтрами для списка концепций

Необходимо реализовать следующие actions:
- setSelectedConcept: выбор текущей концепции
- setFilters: установка фильтров списка
- addConcept: добавление новой концепции
- updateConcept: обновление существующей концепции
- removeConcept: удаление концепции
- setConceptStatus: установка статуса концепции

Асинхронные thunks должны включать:
- fetchConcepts: загрузка списка концепций
- fetchConceptById: загрузка конкретной концепции
- createConcept: создание новой концепции
- saveConcept: сохранение изменений концепции
- deleteConcept: удаление концепции
- importConcept: импорт концепции из файла
- exportConcept: экспорт концепции в файл

Селекторы должны обеспечивать доступ к:
- списку всех концепций
- отфильтрованному списку концепций
- конкретной концепции по ID
- выбранной концепции
- статусу загрузки и ошибкам

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полный исходный код Redux-слайса для концепций
- Примеры использования слайса в компонентах
- Документация по API слайса (actions, thunks, selectors)
```

#### 1.2. Реализация React-компонентов для работы с концепциями

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать React-компоненты для работы с концепциями

КОНТЕКСТ:
- Разработан Redux-слайс для управления концепциями
- Необходимо реализовать все необходимые React-компоненты для работы с концепциями
- Компоненты должны использовать функциональный подход с хуками
- Для стилизации используется Tailwind CSS

ТРЕБОВАНИЯ:
1. Реализовать компоненты для отображения списка концепций
2. Создать компоненты для просмотра детальной информации о концепции
3. Разработать формы для создания и редактирования концепций
4. Обеспечить интеграцию с Redux через хуки
5. Реализовать обработку ошибок и состояний загрузки
6. Обеспечить адаптивность и доступность компонентов

ДЕТАЛИ:
Необходимо разработать следующие компоненты:

1. Список концепций:
   - ConceptList: контейнер для списка концепций
   - ConceptCard: карточка для отображения краткой информации о концепции
   - ConceptFilters: компонент для фильтрации списка концепций
   - ConceptSorting: компонент для сортировки списка
   - EmptyConceptList: компонент для отображения пустого списка

2. Детальная информация о концепции:
   - ConceptDetails: контейнер для детальной информации
   - ConceptHeader: заголовок с базовой информацией
   - ConceptDescription: описание концепции
   - ConceptMetadata: метаданные концепции (теги, связи и т.д.)
   - ConceptActions: панель действий с концепцией

3. Формы для создания и редактирования:
   - ConceptForm: форма для создания/редактирования концепции
   - ConceptNameField: поле для ввода названия
   - ConceptDescriptionField: поле для ввода описания
   - ConceptTagsInput: компонент для управления тегами
   - ConceptMetadataEditor: редактор метаданных

Для всех компонентов необходимо:
- Использовать хуки Redux (useSelector, useDispatch)
- Реализовать обработку состояний загрузки и ошибок
- Обеспечить адаптивность с помощью Tailwind CSS
- Реализовать валидацию форм с использованием Formik и Yup
- Обеспечить доступность согласно стандартам WCAG

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код всех React-компонентов для работы с концепциями
- Примеры использования компонентов
- Описание пропсов и состояний компонентов
- Визуальное представление компонентов (скриншоты или описание)
```

#### 1.3. Создание страниц для управления концепциями

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Создать страницы для управления концепциями

КОНТЕКСТ:
- Разработаны React-компоненты для работы с концепциями
- Настроен роутинг с React Router
- Необходимо создать полноценные страницы для управления концепциями
- Страницы должны интегрироваться с общим layout приложения

ТРЕБОВАНИЯ:
1. Реализовать страницу списка концепций
2. Создать страницу просмотра детальной информации о концепции
3. Разработать страницы создания и редактирования концепций
4. Обеспечить навигацию между страницами
5. Интегрировать страницы с общим layout приложения
6. Реализовать обработку URL-параметров и query-параметров

ДЕТАЛИ:
Необходимо разработать следующие страницы:

1. Страница списка концепций ('/concepts'):
   - Отображение списка всех концепций с возможностью фильтрации и сортировки
   - Панель действий (создание новой концепции, импорт и т.д.)
   - Пагинация для большого количества концепций
   - Поддержка query-параметров для сохранения состояния фильтров и сортировки

2. Страница детальной информации о концепции ('/concepts/:id'):
   - Отображение полной информации о концепции
   - Вкладки для переключения между различными аспектами (основная информация, граф, тезисы)
   - Панель действий (редактирование, удаление, экспорт)
   - Обработка URL-параметра id для загрузки конкретной концепции

3. Страница создания концепции ('/concepts/create'):
   - Форма для ввода информации о новой концепции
   - Валидация данных перед отправкой
   - Обработка отмены и успешного создания

4. Страница редактирования концепции ('/concepts/:id/edit'):
   - Форма с предзаполненными данными существующей концепции
   - Валидация данных перед сохранением
   - Обработка отмены и успешного сохранения
   - Обработка URL-параметра id для загрузки данных концепции

Для каждой страницы необходимо реализовать:
- Корректную работу с роутером (useParams, useNavigate, useLocation)
- Загрузку данных при монтировании компонента
- Обработку ошибок и состояний загрузки
- Интеграцию с общим layout приложения
- Мета-информацию (заголовок страницы, описание)

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код всех страниц для управления концепциями
- Интеграция страниц с роутером и общим layout
- Демонстрация навигации между страницами
- Визуальное представление страниц (скриншоты или описание)
```

#### 1.4. Интеграция с сервисом хранилища данных

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Интегрировать модуль концепций с сервисом локального хранилища данных

КОНТЕКСТ:
- Разработаны Redux-слайс и компоненты для работы с концепциями
- В Фазе 2 создан сервис для работы с локальным хранилищем данных
- Необходимо интегрировать модуль концепций с сервисом хранилища

ТРЕБОВАНИЯ:
1. Интегрировать Redux-thunks с методами сервиса хранилища
2. Обеспечить загрузку, сохранение и удаление концепций
3. Реализовать обработку ошибок при работе с хранилищем
4. Обеспечить оптимистичные обновления для улучшения UX
5. Реализовать кэширование данных для повышения производительности
6. Обеспечить синхронизацию состояния Redux с хранилищем

ДЕТАЛИ:
Необходимо реализовать:

1. Интеграцию Redux-thunks с методами сервиса хранилища:
   - fetchConcepts → dbService.getConcepts()
   - fetchConceptById → dbService.getConcept(id)
   - createConcept → dbService.createConcept(concept)
   - saveConcept → dbService.updateConcept(id, updates)
   - deleteConcept → dbService.deleteConcept(id)
   - importConcept → dbService.importConcept(data)
   - exportConcept → dbService.exportConcept(id)

2. Оптимистичные обновления:
   - Обновлять состояние Redux перед фактическим сохранением
   - Реализовать откат изменений при ошибке сохранения
   - Использовать уникальные временные ID для новых элементов

3. Кэширование и оптимизацию:
   - Реализовать кэширование загруженных концепций
   - Использовать мемоизированные селекторы для предотвращения лишних рендеров
   - Загружать только необходимые данные (например, сначала метаданные, потом полное содержимое)

4. Обработку ошибок:
   - Централизованную обработку ошибок сервиса хранилища
   - Отображение понятных пользователю сообщений об ошибках
   - Логирование ошибок для отладки

5. Синхронизацию состояния:
   - Периодическое обновление данных из хранилища
   - Механизм проверки и разрешения конфликтов при синхронизации
   - Индикацию состояния синхронизации в UI

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полная интеграция модуля концепций с сервисом хранилища
- Корректная работа всех операций с концепциями
- Эффективное кэширование и обновление данных
- Надежная обработка ошибок
- Оптимизированная производительность при работе с большим количеством концепций
```

### 2. Реализация модуля работы с графами

#### 2.1. Разработка Redux-слайса для графов

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать Redux-слайс для работы с графами концепций

КОНТЕКСТ:
- Разработан модуль управления концепциями
- Необходимо создать Redux-слайс для управления графами концепций
- Графы содержат категории и связи между ними
- Для визуализации графов будет использоваться D3.js или Cytoscape.js

ТРЕБОВАНИЯ:
1. Реализовать Redux-слайс с использованием Redux Toolkit
2. Определить структуру состояния для графов, категорий и связей
3. Реализовать actions для управления графами, категориями и связями
4. Создать асинхронные thunks для работы с хранилищем данных
5. Разработать селекторы с мемоизацией для эффективного доступа к данным
6. Обеспечить обработку ошибок и состояний загрузки

ДЕТАЛИ:
Структура состояния должна включать:
- graphs: объект с графами концепций, индексированный по conceptId
- status: состояние загрузки ('idle', 'loading', 'succeeded', 'failed')
- error: сообщение об ошибке
- selectedCategoryId: ID выбранной категории
- selectedRelationshipId: ID выбранной связи
- layout: настройки отображения графа

Необходимо реализовать следующие actions:
- setSelectedGraph: выбор текущего графа
- setSelectedCategory: выбор категории
- setSelectedRelationship: выбор связи
- setLayoutSettings: установка настроек отображения
- addCategory: добавление новой категории
- updateCategory: обновление категории
- removeCategory: удаление категории
- addRelationship: добавление новой связи
- updateRelationship: обновление связи
- removeRelationship: удаление связи
- updateGraphMetadata: обновление метаданных графа

Асинхронные thunks должны включать:
- fetchGraph: загрузка графа концепции
- saveGraph: сохранение графа
- createCategory: создание новой категории
- saveCategory: сохранение изменений категории
- deleteCategory: удаление категории
- createRelationship: создание новой связи
- saveRelationship: сохранение изменений связи
- deleteRelationship: удаление связи
- importGraph: импорт графа из файла
- exportGraph: экспорт графа в файл

Селекторы должны обеспечивать доступ к:
- графу конкретной концепции
- списку категорий графа
- списку связей графа
- конкретной категории по ID
- конкретной связи по ID
- выбранной категории и связи
- статусу загрузки и ошибкам

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полный исходный код Redux-слайса для графов
- Примеры использования слайса в компонентах
- Документация по API слайса (actions, thunks, selectors)
```

#### 2.2. Реализация компонентов для визуализации графа

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать компоненты для визуализации графа концепций

КОНТЕКСТ:
- Разработан Redux-слайс для графов концепций
- Необходимо создать компоненты для визуализации и работы с графами
- Для визуализации будет использоваться D3.js или Cytoscape.js
- Компоненты должны обеспечивать интерактивную работу с графом

ТРЕБОВАНИЯ:
1. Создать основной компонент для визуализации графа
2. Реализовать интерактивные возможности (масштабирование, перемещение, выделение)
3. Разработать компоненты для отображения и редактирования категорий и связей
4. Обеспечить интеграцию с Redux через хуки
5. Создать панель инструментов для работы с графом
6. Реализовать стилизацию элементов графа

ДЕТАЛИ:
Необходимо разработать следующие компоненты:

1. Визуализация графа:
   - GraphVisualization: основной контейнер для визуализации графа
   - GraphRenderer: компонент для рендеринга графа с D3.js/Cytoscape.js
   - GraphControls: элементы управления (масштаб, центрирование, режимы)
   - GraphLegend: легенда для элементов графа

2. Работа с категориями:
   - CategoryNode: компонент для отображения категории в графе
   - CategoryTooltip: всплывающая подсказка при наведении на категорию
   - CategoryContextMenu: контекстное меню для операций с категорией
   - SelectedCategoryHighlight: выделение выбранной категории

3. Работа со связями:
   - RelationshipEdge: компонент для отображения связи в графе
   - RelationshipTooltip: всплывающая подсказка при наведении на связь
   - RelationshipContextMenu: контекстное меню для операций со связью
   - SelectedRelationshipHighlight: выделение выбранной связи

4. Панель инструментов:
   - GraphToolbar: панель инструментов для работы с графом
   - AddCategoryTool: инструмент для добавления категорий
   - AddRelationshipTool: инструмент для создания связей
   - SelectionTool: инструмент для выбора элементов
   - MoveTool: инструмент для перемещения элементов
   - DeleteTool: инструмент для удаления элементов

5. Панели свойств:
   - CategoryPropertiesPanel: панель свойств для выбранной категории
   - RelationshipPropertiesPanel: панель свойств для выбранной связи
   - GraphPropertiesPanel: панель свойств для настройки графа

Интеграция с D3.js/Cytoscape.js должна включать:
- Инициализацию и настройку библиотеки
- Конвертацию данных из Redux в формат библиотеки
- Обработку событий от библиотеки и обновление состояния Redux
- Обновление визуализации при изменении данных
- Стилизацию элементов графа

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код всех компонентов для визуализации графа
- Интеграция с D3.js или Cytoscape.js
- Примеры использования компонентов
- Визуальное представление компонентов (скриншоты или описание)
```

#### 2.3. Создание инструментов для редактирования графа

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать инструменты для редактирования графа концепций

КОНТЕКСТ:
- Разработаны компоненты для визуализации графа
- Необходимо создать инструменты для полноценного редактирования графа
- Инструменты должны обеспечивать удобный пользовательский опыт

ТРЕБОВАНИЯ:
1. Создать формы для создания и редактирования категорий
2. Разработать формы для создания и редактирования связей
3. Реализовать инструменты для управления структурой графа
4. Обеспечить механизмы отмены/повтора действий (undo/redo)
5. Создать инструменты для групповых операций
6. Реализовать валидацию изменений графа

ДЕТАЛИ:
Необходимо разработать следующие инструменты:

1. Формы для работы с категориями:
   - CategoryForm: форма для создания/редактирования категории
   - CategoryNameField: поле для ввода названия категории
   - CategoryDefinitionField: поле для ввода определения
   - CategoryMetricsFields: поля для ввода метрик (centrality, certainty и т.д.)
   - CategoryTraditionsField: поле для связывания с традициями
   - CategoryPositionFields: поля для указания позиции в графе

2. Формы для работы со связями:
   - RelationshipForm: форма для создания/редактирования связи
   - RelationshipTypeField: поле для выбора типа связи
   - RelationshipDirectionField: поле для выбора направления
   - RelationshipStrengthField: поле для указания силы связи
   - RelationshipDescriptionField: поле для ввода описания
   - RelationshipSourceTargetFields: поля для выбора исходной и целевой категорий

3. Инструменты управления структурой:
   - GraphLayoutTool: инструмент для автоматического размещения элементов
   - GraphGroupingTool: инструмент для группировки категорий
   - GraphFilteringTool: инструмент для фильтрации элементов графа
   - GraphAlignmentTool: инструмент для выравнивания элементов
   - GraphZoomTool: инструмент для масштабирования и перемещения

4. Механизмы отмены/повтора:
   - ActionHistory: компонент для управления историей действий
   - UndoButton: кнопка для отмены последнего действия
   - RedoButton: кнопка для повтора отмененного действия
   - ActionList: список выполненных действий

5. Групповые операции:
   - MultiSelectionTool: инструмент для выбора нескольких элементов
   - BulkEditTool: инструмент для групповых изменений
   - BatchDeleteTool: инструмент для удаления нескольких элементов
   - DuplicateTool: инструмент для дублирования элементов

6. Валидация изменений:
   - GraphValidator: компонент для валидации изменений графа
   - ValidationErrorsList: список ошибок валидации
   - ValidationWarningsList: список предупреждений
   - FixSuggestionsPanel: панель с предложениями по исправлению ошибок

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код всех инструментов для редактирования графа
- Примеры использования инструментов
- Интеграция инструментов с компонентами визуализации
- Визуальное представление инструментов (скриншоты или описание)
```

#### 2.4. Интеграция с D3.js или Cytoscape.js

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Интегрировать модуль графов с D3.js или Cytoscape.js

КОНТЕКСТ:
- Разработаны компоненты и инструменты для работы с графами
- Необходимо интегрировать модуль с библиотекой для визуализации графов
- Библиотека должна обеспечивать интерактивную визуализацию и редактирование

ТРЕБОВАНИЯ:
1. Выбрать оптимальную библиотеку (D3.js или Cytoscape.js)
2. Разработать классы-адаптеры для работы с выбранной библиотекой
3. Обеспечить двустороннюю связь между Redux и библиотекой
4. Реализовать кастомные стили для элементов графа
5. Оптимизировать производительность при работе с большими графами
6. Обеспечить поддержку всех требуемых интерактивных функций

ДЕТАЛИ:
Необходимо реализовать следующие компоненты и функции:

1. Инициализация и настройка библиотеки:
   - GraphLibraryWrapper: компонент-обертка для работы с библиотекой
   - initializeGraph: функция инициализации графа
   - destroyGraph: функция для корректного удаления графа
   - configureGraphOptions: функция настройки опций

2. Преобразование данных:
   - convertStateToGraphData: функция преобразования данных из Redux в формат библиотеки
   - convertGraphEventsToActions: функция преобразования событий библиотеки в actions Redux
   - syncGraphWithState: функция синхронизации состояния графа с Redux

3. Обработка событий:
   - setupGraphEventHandlers: функция настройки обработчиков событий
   - handleNodeClick: обработчик клика по узлу
   - handleEdgeClick: обработчик клика по ребру
   - handleDragStart/End: обработчики начала и окончания перетаскивания
   - handleZoom: обработчик изменения масштаба

4. Стилизация:
   - graphStylesheet: стили для элементов графа
   - nodeStyleFunction: функция стилизации узлов
   - edgeStyleFunction: функция стилизации ребер
   - applyLayoutSettings: функция применения настроек расположения

5. Производительность:
   - batchGraphUpdates: функция пакетного обновления графа
   - lazyRenderingStrategy: стратегия ленивого рендеринга для больших графов
   - graphViewportOptimization: оптимизация отображения только видимых элементов

6. Поддержка интерактивных функций:
   - addNodeInteraction: функция добавления узла через интерфейс
   - addEdgeInteraction: функция добавления ребра через интерфейс
   - editNodeInteraction: функция редактирования узла
   - editEdgeInteraction: функция редактирования ребра
   - selectionInteraction: функция выбора элементов
   - panZoomInteraction: функция перемещения и масштабирования

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код интеграции с выбранной библиотекой
- Класс-адаптер для работы с библиотекой
- Функции преобразования данных и обработки событий
- Оптимизации для работы с большими графами
- Примеры использования библиотеки в компонентах
```

### 3. Реализация модуля работы с тезисами

#### 3.1. Разработка Redux-слайса для тезисов

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать Redux-слайс для управления тезисами

КОНТЕКСТ:
- Разработаны модули концепций и графов
- Необходимо создать Redux-слайс для управления тезисами
- Тезисы имеют связи с концепциями и категориями

ТРЕБОВАНИЯ:
1. Реализовать Redux-слайс с использованием Redux Toolkit
2. Определить структуру состояния для тезисов
3. Реализовать actions для CRUD-операций с тезисами
4. Создать асинхронные thunks для работы с хранилищем данных
5. Разработать селекторы с мемоизацией для эффективного доступа к данным
6. Обеспечить обработку ошибок и состояний загрузки

ДЕТАЛИ:
Структура состояния должна включать:
- items: массив или объект с тезисами
- status: состояние загрузки ('idle', 'loading', 'succeeded', 'failed')
- error: сообщение об ошибке
- selectedThesisId: ID выбранного тезиса
- filters: объект с фильтрами для списка тезисов

Необходимо реализовать следующие actions:
- setSelectedThesis: выбор текущего тезиса
- setFilters: установка фильтров списка
- addThesis: добавление нового тезиса
- updateThesis: обновление существующего тезиса
- removeThesis: удаление тезиса
- setThesisRelatedCategories: установка связанных категорий

Асинхронные thunks должны включать:
- fetchTheses: загрузка списка тезисов
- fetchThesisByConceptId: загрузка тезисов для конкретной концепции
- fetchThesisById: загрузка конкретного тезиса
- createThesis: создание нового тезиса
- saveThesis: сохранение изменений тезиса
- deleteThesis: удаление тезиса
- generateThesesWithClaude: генерация тезисов с помощью Claude API

Селекторы должны обеспечивать доступ к:
- списку всех тезисов
- отфильтрованному списку тезисов
- тезисам для конкретной концепции
- тезисам для конкретной категории
- конкретному тезису по ID
- выбранному тезису
- статусу загрузки и ошибкам

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полный исходный код Redux-слайса для тезисов
- Примеры использования слайса в компонентах
- Документация по API слайса (actions, thunks, selectors)
```

#### 3.2. Реализация компонентов для управления тезисами

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать компоненты для управления тезисами

КОНТЕКСТ:
- Разработан Redux-слайс для управления тезисами
- Необходимо создать компоненты для работы с тезисами
- Тезисы имеют связи с концепциями и категориями

ТРЕБОВАНИЯ:
1. Реализовать компоненты для отображения списка тезисов
2. Создать компоненты для просмотра детальной информации о тезисе
3. Разработать формы для создания и редактирования тезисов
4. Обеспечить механизм связывания тезисов с категориями графа
5. Реализовать фильтрацию и сортировку тезисов
6. Обеспечить интеграцию с Redux через хуки

ДЕТАЛИ:
Необходимо разработать следующие компоненты:

1. Список тезисов:
   - ThesisList: контейнер для списка тезисов
   - ThesisCard: карточка для отображения краткой информации о тезисе
   - ThesisFilters: компонент для фильтрации списка тезисов
   - ThesisSorting: компонент для сортировки списка
   - EmptyThesisList: компонент для отображения пустого списка

2. Детальная информация о тезисе:
   - ThesisDetails: контейнер для детальной информации
   - ThesisHeader: заголовок с базовой информацией
   - ThesisContent: основное содержание тезиса
   - ThesisMetadata: метаданные тезиса (тип, стиль и т.д.)
   - ThesisRelatedCategories: связанные категории
   - ThesisActions: панель действий с тезисом

3. Формы для создания и редактирования:
   - ThesisForm: форма для создания/редактирования тезиса
   - ThesisContentField: поле для ввода содержания
   - ThesisTypeField: поле для выбора типа тезиса
   - ThesisStyleField: поле для выбора стиля
   - ThesisRelatedCategoriesSelector: компонент для выбора связанных категорий

4. Связывание с категориями:
   - CategorySelector: компонент для выбора категорий из графа
   - CategoryTree: иерархическое отображение категорий
   - CategorySearchField: поле для поиска категорий
   - SelectedCategoriesList: список выбранных категорий

5. Фильтрация и сортировка:
   - ThesisFilterPanel: панель с фильтрами
   - ThesisTypeFilter: фильтр по типу тезиса
   - ThesisStyleFilter: фильтр по стилю
   - ThesisCategoryFilter: фильтр по связанным категориям
   - ThesisSortPanel: панель для сортировки

6. Генерация тезисов с помощью Claude:
   - ThesisGenerationForm: форма для настройки генерации
   - GenerationParametersFields: поля для настройки параметров
   - GenerationProgress: индикатор прогресса генерации
   - GeneratedThesesList: список сгенерированных тезисов

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код всех компонентов для управления тезисами
- Примеры использования компонентов
- Описание пропсов и состояний компонентов
- Визуальное представление компонентов (скриншоты или описание)
```

#### 3.3. Создание форм для создания и редактирования тезисов

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать формы для создания и редактирования тезисов

КОНТЕКСТ:
- Разработаны компоненты для управления тезисами
- Необходимо создать полноценные формы для создания и редактирования тезисов
- Формы должны обеспечивать валидацию и удобный пользовательский опыт

ТРЕБОВАНИЯ:
1. Реализовать форму для создания нового тезиса
2. Создать форму для редактирования существующего тезиса
3. Обеспечить валидацию всех полей
4. Реализовать механизм выбора связанных категорий
5. Обеспечить удобный пользовательский интерфейс
6. Интегрировать формы с Redux-слайсом

ДЕТАЛИ:
Необходимо разработать следующие компоненты и функциональность:

1. Форма создания тезиса:
   - CreateThesisForm: основной компонент формы
   - Поля для ввода всех атрибутов тезиса:
     - Содержание тезиса (textarea с поддержкой форматирования)
     - Тип тезиса (select с предопределенными типами)
     - Стиль тезиса (select с предопределенными стилями)
     - Связанная концепция (select или hidden, если известно из контекста)
   - Выбор связанных категорий (специальный компонент)
   - Кнопки "Создать", "Создать и создать ещё", "Отмена"
   - Индикация процесса сохранения

2. Форма редактирования тезиса:
   - EditThesisForm: основной компонент формы
   - Предзаполненные поля с данными текущего тезиса
   - Все поля аналогичны форме создания
   - Кнопки "Сохранить", "Отмена", "Удалить"
   - Предупреждение при несохраненных изменениях

3. Компонент выбора связанных категорий:
   - RelatedCategoriesSelector: основной компонент
   - Визуализация графа категорий в миниатюре
   - Список категорий с возможностью поиска и фильтрации
   - Индикация выбранных категорий
   - Подсветка выбранных категорий в миниатюре графа

4. Валидация данных:
   - Использование Formik для управления формой
   - Использование Yup для определения схемы валидации
   - Валидационные правила:
     - Содержание: обязательное, минимальная длина, максимальная длина
     - Тип: обязательный, из списка допустимых значений
     - Стиль: обязательный, из списка допустимых значений
     - Связанные категории: хотя бы одна категория
   - Отображение ошибок валидации рядом с полями
   - Предотвращение отправки невалидной формы

5. Расширенные возможности:
   - Предпросмотр тезиса в различных стилях
   - Автосохранение черновика
   - История изменений
   - Теги для дополнительной классификации
   - Рекомендации по улучшению тезиса

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код форм для создания и редактирования тезисов
- Схемы валидации данных
- Компонент выбора связанных категорий
- Примеры использования форм
- Визуальное представление форм (скриншоты или описание)
```

#### 3.4. Интеграция с сервисом хранилища данных

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Интегрировать модуль тезисов с сервисом локального хранилища данных

КОНТЕКСТ:
- Разработаны компоненты и формы для работы с тезисами
- В Фазе 2 создан сервис для работы с локальным хранилищем данных
- Необходимо интегрировать модуль тезисов с сервисом хранилища

ТРЕБОВАНИЯ:
1. Интегрировать Redux-thunks с методами сервиса хранилища
2. Обеспечить загрузку, сохранение и удаление тезисов
3. Реализовать взаимодействие с хранилищем для связывания тезисов с категориями
4. Обеспечить обработку ошибок при работе с хранилищем
5. Реализовать оптимистичные обновления для улучшения UX
6. Обеспечить кэширование данных для повышения производительности

ДЕТАЛИ:
Необходимо реализовать:

1. Интеграцию Redux-thunks с методами сервиса хранилища:
   - fetchTheses → dbService.getTheses(filters)
   - fetchThesisByConceptId → dbService.getThesesByConceptId(conceptId)
   - fetchThesisById → dbService.getThesis(id)
   - createThesis → dbService.createThesis(thesis)
   - saveThesis → dbService.updateThesis(id, updates)
   - deleteThesis → dbService.deleteThesis(id)

2. Работу со связями между тезисами и категориями:
   - getThesesByCategory → dbService.getThesesByCategory(categoryId)
   - linkThesisToCategory → dbService.linkThesisToCategory(thesisId, categoryId)
   - unlinkThesisFromCategory → dbService.unlinkThesisFromCategory(thesisId, categoryId)
   - getRelatedCategories → dbService.getThesisRelatedCategories(thesisId)

3. Оптимистичные обновления:
   - Обновление состояния Redux перед фактическим сохранением
   - Откат изменений при ошибке сохранения
   - Использование уникальных временных ID для новых элементов

4. Кэширование и оптимизацию:
   - Кэширование загруженных тезисов
   - Мемоизация селекторов для предотвращения лишних рендеров
   - Загрузка тезисов при необходимости (ленивая загрузка)

5. Обработку ошибок:
   - Централизованная обработка ошибок сервиса хранилища
   - Понятные сообщения об ошибках для пользователя
   - Логирование ошибок для отладки

6. Синхронизацию состояния:
   - Периодическое обновление данных из хранилища
   - Разрешение конфликтов при синхронизации
   - Индикация состояния синхронизации в UI

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полная интеграция модуля тезисов с сервисом хранилища
- Корректная работа всех операций с тезисами
- Эффективное кэширование и обновление данных
- Надежная обработка ошибок
- Оптимизированная производительность при работе с большим количеством тезисов
```

### 4. Интеграция с бэкенд-прокси

#### 4.1. Разработка сервиса для взаимодействия с бэкенд-прокси

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать сервис для взаимодействия с бэкенд-прокси Claude API

КОНТЕКСТ:
- Разработаны модули концепций, графов и тезисов
- В Фазе 2 создан бэкенд-прокси для взаимодействия с Claude API
- Необходимо разработать сервис для взаимодействия с бэкенд-прокси

ТРЕБОВАНИЯ:
1. Создать сервис для отправки запросов к бэкенд-прокси
2. Реализовать методы для синхронных и асинхронных запросов
3. Разработать форматтеры запросов для различных типов анализа
4. Создать обработчики ответов от Claude API
5. Реализовать механизм отслеживания статуса асинхронных задач
6. Обеспечить обработку ошибок и повторные попытки

ДЕТАЛИ:
Необходимо разработать следующие компоненты и функциональность:

1. Основной сервис для взаимодействия с API:
   - claudeService.js: основной файл сервиса
   - Методы для синхронных запросов:
     - queryClaude(queryType, content, parameters)
   - Методы для асинхронных запросов:
     - queueClaudeQuery(queryType, content, parameters)
     - checkTaskStatus(taskId)
     - getTaskResult(taskId)
   - Конфигурация:
     - настройка базового URL
     - настройка таймаутов
     - настройка повторных попыток
     - настройка авторизации

2. Форматтеры запросов для различных типов анализа:
   - formatGraphValidationQuery(graph): формирование запроса для валидации графа
   - formatThesisGenerationQuery(graph, quantity, type, style): формирование запроса для генерации тезисов
   - formatConceptSynthesisQuery(concepts, parameters): формирование запроса для синтеза концепций
   - formatConceptAnalysisQuery(concept, analysisType): формирование запроса для анализа концепции
   - formatNameAnalysisQuery(name, concept): формирование запроса для анализа названия

3. Обработчики ответов:
   - parseClaudeValidationResponse(response): обработка ответа валидации
   - parseClaudeThesisGenerationResponse(response): обработка ответа генерации тезисов
   - parseClaudeSynthesisResponse(response): обработка ответа синтеза
   - parseClaudeAnalysisResponse(response): обработка ответа анализа
   - parseClaudeNameAnalysisResponse(response): обработка ответа анализа названия

4. Механизм отслеживания статуса асинхронных задач:
   - TaskTracker: класс для отслеживания задач
   - методы для запуска отслеживания: startTracking(taskId)
   - методы для проверки статуса: checkStatus(taskId)
   - события при изменении статуса: onStatusChange(callback)
   - механизм периодического опроса: pollTaskStatus(taskId, interval)

5. Обработка ошибок:
   - создание собственных классов ошибок: ClaudeApiError, NetworkError, и т.д.
   - механизм повторных попыток: retry(fn, options)
   - логирование ошибок: logError(error)
   - обработка различных типов ошибок: handleApiError, handleNetworkError и т.д.

6. Кэширование запросов:
   - механизм кэширования идентичных запросов
   - управление кэшем: clearCache(), invalidateCacheEntry(key)
   - настройка TTL для кэша

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полный исходный код сервиса взаимодействия с бэкенд-прокси
- Форматтеры запросов для различных типов анализа
- Обработчики ответов от Claude API
- Механизм отслеживания асинхронных задач
- Примеры использования сервиса в приложении
```

#### 4.2. Реализация механизма формирования запросов к Claude

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать механизм формирования запросов к Claude API

КОНТЕКСТ:
- Разработан сервис для взаимодействия с бэкенд-прокси
- Необходимо создать механизм формирования различных типов запросов к Claude API
- Механизм должен быть гибким и расширяемым

ТРЕБОВАНИЯ:
1. Разработать типовые шаблоны запросов для основных сценариев
2. Создать механизм параметризации шаблонов
3. Реализовать форматтеры данных для включения в запросы
4. Обеспечить локализацию запросов
5. Реализовать механизм контроля размера запросов
6. Обеспечить возможность расширения набора запросов

ДЕТАЛИ:
Необходимо разработать следующие шаблоны и механизмы:

1. Базовые шаблоны запросов:
   - QueryTemplates: объект с шаблонами запросов
   - templateValidateGraph: шаблон для валидации графа
   - templateGenerateTheses: шаблон для генерации тезисов
   - templateSynthesizeConcepts: шаблон для синтеза концепций
   - templateAnalyzeConcept: шаблон для анализа концепции
   - templateAnalyzeName: шаблон для анализа названия

2. Механизм параметризации шаблонов:
   - TemplateEngine: класс для работы с шаблонами
   - метод compile(template, parameters): компиляция шаблона с параметрами
   - поддержка условных блоков: {{#if condition}}...{{/if}}
   - поддержка циклов: {{#each items}}...{{/each}}
   - форматирование значений: {{format value "json"}}

3. Форматтеры данных:
   - DataFormatters: объект с форматтерами
   - formatGraph(graph): форматирование графа для запроса
   - formatConcept(concept): форматирование концепции
   - formatCategories(categories): форматирование списка категорий
   - formatTheses(theses): форматирование списка тезисов
   - форматирование в различных представлениях (JSON, текст, структурированные данные)

4. Локализация запросов:
   - механизм локализации шаблонов
   - загрузка шаблонов для разных языков
   - переключение языка запросов

5. Контроль размера запросов:
   - механизм проверки размера запроса (токены, символы)
   - стратегии сокращения запроса при превышении лимитов
   - разбиение больших запросов на части
   - приоритизация данных при сокращении

6. Расширение набора запросов:
   - механизм регистрации новых шаблонов
   - фабрика запросов для создания сложных составных запросов
   - хранение истории запросов для аналитики и оптимизации

Примеры шаблонов:

1. Валидация графа:
```
Проанализируй следующий граф категорий философской концепции:
{{format graph "json"}}

Выяви возможные логические противоречия, пропущенные важные категории или связи, необычные отношения между категориями. Предложи возможные улучшения.
```

2. Генерация тезисов:
```
На основе следующего графа философской концепции:
{{format graph "json"}}

Сформулируй {{quantity}} ключевых тезисов в области {{thesisType}}. Тезисы должны отражать структурные отношения между категориями и быть выражены в {{style}} стиле. Для каждого тезиса укажи, из каких именно элементов графа он логически следует.
```

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код механизма формирования запросов
- Реализация типовых шаблонов запросов
- Механизм параметризации и форматирования
- Примеры использования механизма
- Документация по расширению набора запросов
```

#### 4.3. Создание компонентов для отображения результатов

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Разработать компоненты для отображения результатов взаимодействия с Claude API

КОНТЕКСТ:
- Разработан сервис и механизм формирования запросов к Claude API
- Необходимо создать компоненты для отображения результатов различных типов анализа
- Компоненты должны обеспечивать удобный пользовательский опыт

ТРЕБОВАНИЯ:
1. Разработать компоненты для отображения результатов различных типов анализа
2. Создать интерактивные элементы для работы с результатами
3. Обеспечить визуализацию сложных данных
4. Реализовать обработку процесса загрузки и ошибок
5. Обеспечить возможность сохранения и экспорта результатов
6. Интегрировать компоненты с основными модулями приложения

ДЕТАЛИ:
Необходимо разработать следующие компоненты:

1. Базовые компоненты для отображения результатов:
   - ClaudeResultContainer: контейнер для результатов
   - LoadingIndicator: индикатор загрузки
   - ErrorDisplay: отображение ошибок
   - ResultActionPanel: панель действий с результатами (сохранение, экспорт)

2. Компоненты для отображения результатов валидации графа:
   - GraphValidationResult: основной компонент
   - IssuesList: список обнаруженных проблем
   - IssueDetails: детали проблемы с предложениями по исправлению
   - GraphImprovementSuggestions: предложения по улучшению графа
   - ImplementSuggestionButton: кнопка для применения предложения

3. Компоненты для отображения результатов генерации тезисов:
   - GeneratedThesesResult: основной компонент
   - GeneratedThesisList: список сгенерированных тезисов
   - ThesisPreview: предпросмотр тезиса
   - ThesisSourceCategories: категории, из которых следует тезис
   - SaveThesisButton: кнопка для сохранения тезиса
   - ThesisBatchActions: действия с группой тезисов

4. Компоненты для отображения результатов синтеза концепций:
   - ConceptSynthesisResult: основной компонент
   - SynthesizedConceptPreview: предпросмотр синтезированной концепции
   - SynthesisExplanation: объяснение процесса синтеза
   - SynthesizedGraphPreview: предпросмотр графа синтезированной концепции
   - SaveSynthesizedConceptButton: кнопка для сохранения результата
   - AdjustSynthesisParameters: настройка параметров для повторного синтеза

5. Компоненты для отображения результатов анализа концепции:
   - ConceptAnalysisResult: основной компонент
   - AnalysisSection: раздел с результатами анализа
   - AnalysisVisualization: визуализация результатов анализа
   - AnalysisInsights: ключевые выводы анализа
   - ApplyInsightButton: применение выводов анализа
   - AnalysisExport: экспорт результатов анализа

6. Компоненты для отображения результатов анализа названия:
   - NameAnalysisResult: основной компонент
   - NameSuggestionsList: список предложенных названий
   - NameRating: оценка названия по различным критериям
   - NameOriginInfo: информация о происхождении названия
   - NameAssociations: ассоциации с названием
   - ApplyNameButton: применение выбранного названия

7. Общие элементы интерфейса для работы с результатами:
   - AsyncTaskProgress: прогресс выполнения асинхронной задачи
   - ResultHistory: история результатов
   - ResultComparison: сравнение результатов
   - ResultAnnotation: добавление заметок к результатам
   - ResultShareOptions: возможности поделиться результатами

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Исходный код компонентов для отображения результатов
- Стили и анимации для компонентов
- Интеграция с основными модулями приложения
- Примеры использования компонентов
- Визуальное представление компонентов (скриншоты или описание)
```

#### 4.4. Интеграция с остальными модулями

**Запрос для Claude 3.7:**
```
ЗАДАЧА: Интегрировать модуль взаимодействия с Claude API с остальными модулями приложения

КОНТЕКСТ:
- Разработаны модули концепций, графов и тезисов
- Разработан сервис для взаимодействия с бэкенд-прокси Claude API
- Необходимо интегрировать модуль Claude API с остальными модулями

ТРЕБОВАНИЯ:
1. Интегрировать функциональность Claude API с модулем концепций
2. Обеспечить взаимодействие с модулем графов
3. Интегрировать генерацию и анализ тезисов
4. Реализовать сохранение результатов взаимодействия с Claude
5. Обеспечить возможность использования Claude API в различных частях приложения
6. Реализовать единый подход к обработке асинхронных задач Claude

ДЕТАЛИ:
Необходимо реализовать следующие интеграции:

1. Интеграция с модулем концепций:
   - Redux-thunks для анализа концепций:
     - analyzeConceptWithClaude(conceptId, analysisType)
     - analyzeConceptNameWithClaude(conceptId)
     - getConceptOriginWithClaude(conceptId)
   - UI-компоненты для запуска анализа концепций
   - Сохранение результатов анализа в метаданных концепции

2. Интеграция с модулем графов:
   - Redux-thunks для валидации и улучшения графов:
     - validateGraphWithClaude(conceptId)
     - suggestGraphImprovementsWithClaude(conceptId)
     - applyClaudeSuggestionToGraph(conceptId, suggestionId)
   - UI-компоненты для запуска валидации графа
   - Визуализация результатов валидации на графе

3. Интеграция с модулем тезисов:
   - Redux-thunks для генерации и анализа тезисов:
     - generateThesesWithClaude(conceptId, parameters)
     - analyzeThesisWithClaude(thesisId)
     - improveSingleThesisWithClaude(thesisId, parameters)
   - UI-компоненты для запуска генерации тезисов
   - Сохранение сгенерированных тезисов

4. Сохранение истории взаимодействий:
   - Redux-слайс для истории взаимодействий с Claude:
     - структура состояния для взаимодействий
     - actions для добавления/обновления записей
     - селекторы для доступа к истории
   - Сервис для работы с историей взаимодействий
   - UI-компоненты для просмотра истории

5. Общая инфраструктура для асинхронных задач:
   - TaskManager: сервис для управления асинхронными задачами
   - Redux-слайс для статуса задач
   - UI-компоненты для отображения статуса задач
   - Механизм отмены задач
   - Обработка ошибок и повторные попытки

6. Middleware для интеграции с Redux:
   - claudeMiddleware: middleware для перехвата действий, связанных с Claude API
   - автоматическое сохранение истории взаимодействий
   - кэширование результатов
   - обработка ошибок

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- Полная интеграция модуля Claude API с остальными модулями
- Redux-thunks для основных операций
- UI-компоненты для запуска и отображения результатов
- Механизм сохранения истории взаимодействий
- Единая инфраструктура для асинхронных задач
- Примеры использования в различных частях приложения
```

## График выполнения

| № | Задача | Запросы к Claude 3.7 | Оценка сессий |
|---|--------|-------------------|--------------|
| 1 | Реализация модуля управления концепциями | 4 запроса | 7-9 сессий |
| 2 | Реализация модуля работы с графами | 4 запроса | 9-12 сессий |
| 3 | Реализация модуля работы с тезисами | 4 запроса | 7-9 сессий |
| 4 | Интеграция с бэкенд-прокси | 4 запроса | 7-10 сессий |
| | **ИТОГО** | **16 запросов** | **30-40 сессий** |

## Ожидаемые результаты

По завершении Фазы 3 мы получим:

1. Полнофункциональный модуль управления концепциями со всеми компонентами и интеграцией с хранилищем данных
2. Модуль работы с графами, включающий визуализацию и редактирование графов концепций с использованием D3.js или Cytoscape.js
3. Модуль работы с тезисами, позволяющий создавать, редактировать и связывать тезисы с концепциями и категориями
4. Интеграцию с бэкенд-прокси для использования возможностей Claude API в различных частях приложения

Эти результаты образуют ядро приложения и обеспечивают базовую функциональность сервиса философских концепций.

## Контрольные точки и критерии успеха

1. **Модуль управления концепциями**
   - Реализован полный CRUD для концепций
   - Созданы все компоненты для работы с концепциями
   - Выполнена интеграция с хранилищем данных
   - Реализованы механизмы фильтрации и сортировки

2. **Модуль работы с графами**
   - Реализована визуализация графа с D3.js или Cytoscape.js
   - Созданы инструменты для редактирования графа
   - Обеспечена интерактивность работы с графом
   - Реализованы механизмы валидации и оптимизации графа

3. **Модуль работы с тезисами**
   - Реализован полный CRUD для тезисов
   - Созданы формы для создания и редактирования тезисов
   - Обеспечена возможность связывания тезисов с категориями
   - Реализованы механизмы фильтрации и сортировки

4. **Интеграция с бэкенд-прокси**
   - Реализован сервис для взаимодействия с бэкенд-прокси
   - Созданы компоненты для отображения результатов
   - Обеспечена интеграция с основными модулями приложения
   - Реализован механизм сохранения истории взаимодействий

## Риски и стратегии их снижения

| Риск | Вероятность | Влияние | Стратегия снижения |
|------|-------------|---------|-------------------|
| Сложности при интеграции с библиотеками для визуализации графов | Высокая | Высокое | Создание прототипов перед полной интеграцией, использование компонентов-оберток, изучение примеров интеграции |
| Проблемы производительности при работе с большими графами | Высокая | Высокое | Оптимизация рендеринга, использование виртуализации, разделение графа на части, применение алгоритмов оптимизации |
| Сложности при формировании запросов к Claude API | Средняя | Среднее | Создание гибкой системы шаблонов, тестирование на различных сценариях, механизм мониторинга и оптимизации запросов |
| Несоответствие между схемой данных и требованиями UI | Средняя | Среднее | Итеративная разработка, частые ревью, адаптеры данных, гибкая архитектура |

## Следующие шаги

После успешного завершения Фазы 3 мы переходим к Фазе 4: Разработка расширенных функций, где будем реализовывать:

1. Синтез концепций
2. Анализ названий концепций
3. Определение происхождения концепций
4. Дополнительные функции (историческая контекстуализация, анализ практического применения и т.д.)
